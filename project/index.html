<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–æ–ª–µ–≤–∞ –ö—Ä–∞—Å–æ—Ç—ã</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4db6ac;
            --primary-dark: #00897b;
            --bg-color: #b2dfdb;
            --app-bg: #26a69a;
            --card-bg: rgba(255, 255, 255, 0.15);
            --text-color: #ffffff;
            --accent-yellow: #fdd835;
            --accent-pink: #f06292;
            --accent-blue: #4fc3f7;
            --accent-purple: #ab47bc;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        /* –ò–º–∏—Ç–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ */
        #mobile-app {
            width: 375px;
            height: 800px;
            background: linear-gradient(180deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* --- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –†–ï–°–£–†–°–û–í --- */
        .top-bar {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0,0,0,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            position: relative;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–∞–π–º–µ—Ä–∞ —ç–Ω–µ—Ä–≥–∏–∏ */
        .energy-timer {
            position: absolute;
            bottom: -12px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 9px;
            color: rgba(255,255,255,0.8);
        }

        .res-icon {
            margin-right: 2px;
        }

        /* --- –®–ö–ê–õ–ê –û–ü–´–¢–ê (LEVEL BAR) --- */
        .level-container {
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .level-badge {
            background: var(--accent-yellow);
            color: var(--primary-dark);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .xp-bar-bg {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #fdd835, #fbc02d);
            width: 0%;
            transition: width 0.5s ease;
        }

        .level-title {
            color: white;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-left: auto;
        }

        /* --- –ó–ê–ì–û–õ–û–í–û–ö –°–¢–†–ê–ù–ò–¶–´ --- */
        .page-header {
            text-align: center;
            padding: 15px 0;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 16px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* --- –û–°–ù–û–í–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ –ö–û–ù–¢–ï–ù–¢–ê --- */
        #content-area {
            flex: 1;
            overflow-y: auto;
            padding: 0 15px 20px 15px;
            scrollbar-width: none;
        }

            #content-area::-webkit-scrollbar {
                display: none;
            }

        /* --- –ö–ê–†–¢–û–ß–ö–ò –ò –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            position: relative;
        }

            /* –ë–ª–∏–∫ –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è */
            .card.highlight {
                border: 1px solid var(--accent-yellow);
                animation: pulseBorder 2s infinite;
            }

        @keyframes pulseBorder {
            0% {
                box-shadow: 0 0 0 0 rgba(253, 216, 53, 0.4);
            }

            70% {
                box-shadow: 0 0 0 6px rgba(253, 216, 53, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(253, 216, 53, 0);
            }
        }

        .btn-action {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }

            .btn-action:active {
                transform: scale(0.98);
            }

            .btn-action:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

        .btn-blue {
            background: linear-gradient(90deg, #29b6f6, #0288d1);
            color: white;
        }

        .btn-pink {
            background: linear-gradient(90deg, #ec407a, #c2185b);
            color: white;
        }

        .btn-teal {
            background: linear-gradient(90deg, #26a69a, #00695c);
            color: white;
        }

        .btn-purple {
            background: linear-gradient(90deg, #ab47bc, #7b1fa2);
            color: white;
        }

        .btn-gold {
            background: linear-gradient(90deg, #fdd835, #fbc02d);
            color: #4e342e;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã */
        .progress-container {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            height: 12px;
            width: 100%;
            margin: 8px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #a7ffeb, #1de9b6);
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø --- */
        .bottom-nav {
            background-color: var(--primary-dark);
            height: 70px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 20;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255,255,255,0.6);
            font-size: 9px;
            cursor: pointer;
            width: 16%;
            text-align: center;
            transition: color 0.3s;
        }

            .nav-item.active {
                color: #ffffff;
            }

                .nav-item.active i {
                    color: var(--accent-yellow);
                    transform: translateY(-2px);
                    transition: transform 0.3s;
                }

            .nav-item i {
                font-size: 18px;
                margin-bottom: 4px;
            }

        /* –ë—ç–π–¥–∂–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .badge-notify {
            position: absolute;
            top: -5px;
            right: 15px;
            background: var(--accent-pink);
            color: white;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid white;
        }

        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ */
        .avatar-placeholder {
            width: 140px;
            height: 200px;
            background-color: #e0e0e0;
            border-radius: 100px 100px 20px 20px;
            margin: 0 auto 20px;
            border: 4px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-image: url('https://img.freepik.com/free-vector/fashion-model-sketch-style_23-2147551066.jpg?auto=format&h=500');
            position: relative;
        }

        /* –ö–æ–º–ø–∞–Ω–∏—è */
        .company-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .company-logo {
            width: 50px;
            height: 50px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-dark);
            font-size: 24px;
            font-weight: bold;
        }

        /* –£—á–∞—Å—Ç–Ω–∏—Ü—ã –∫–æ–º–ø–∞–Ω–∏–∏ */
        .member-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .member-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 12px;
        }

        .member-main {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .member-avatar {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: var(--primary-dark);
        }

        .role-badge {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-ceo {
            background: rgba(253,216,53,0.2);
            color: var(--accent-yellow);
            border: 1px solid rgba(253,216,53,0.7);
        }

        .role-art {
            background: rgba(240,98,146,0.18);
            color: var(--accent-pink);
            border: 1px solid rgba(240,98,146,0.7);
        }

        .role-top {
            background: rgba(79,195,247,0.18);
            color: var(--accent-blue);
            border: 1px solid rgba(79,195,247,0.7);
        }

        .role-trainee {
            background: rgba(171,71,188,0.18);
            color: var(--accent-purple);
            border: 1px solid rgba(171,71,188,0.7);
        }

        .member-status {
            font-size: 10px;
            opacity: 0.75;
        }

        .member-status.online {
            color: #a5d6a7;
        }

        .member-status.offline {
            color: rgba(255,255,255,0.5);
        }

        /* --- –°–¢–ò–õ–ò –î–õ–Ø –§–û–†–£–ú–ê --- */
        .forum-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .forum-topic {
            background: var(--card-bg);
            color: #fff;
            margin-bottom: 10px;
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.07);
            transition: background 0.2s;
        }

            .forum-topic:hover {
                background: rgba(255,255,255,0.23);
            }

        .forum-thread-title {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 15px;
            color: var(--accent-yellow);
        }

        .forum-messages {
            margin: 15px 0 15px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .forum-message {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 8px;
            font-size: 13px;
            border-left: 3px solid transparent;
        }

            .forum-message.from-me {
                background: rgba(255, 255, 255, 0.15);
                border-left: 3px solid var(--accent-pink);
            }

        .forum-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            box-sizing: border-box;
        }

        /* –ö–í–ï–°–¢–´ */
        .quest-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .quest-check {
            color: rgba(255,255,255,0.3);
            margin-right: 10px;
        }

            .quest-check.done {
                color: var(--accent-yellow);
            }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        .toast {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #00897b, #00695c);
            width: 80%;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            color: white;
            border: 2px solid var(--accent-yellow);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div id="mobile-app">
        <div id="toast" class="toast">–î–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!</div>

        <div id="modal" class="modal-overlay" onclick="closeModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <i class="fas fa-gift" style="font-size: 40px; color: var(--accent-yellow); margin-bottom: 10px;"></i>
                <h3 id="modalTitle">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ë–æ–Ω—É—Å!</h3>
                <p id="modalText">–í—ã –∑–∞—à–ª–∏ –≤ –∏–≥—Ä—É –∏ –ø–æ–ª—É—á–∏–ª–∏ –Ω–∞–≥—Ä–∞–¥—É.</p>
                <button class="btn-action btn-gold" onclick="closeModal()">–ó–∞–±—Ä–∞—Ç—å</button>
            </div>
        </div>

        <div class="top-bar">
            <div class="resource-item"><span class="res-icon">üí∞</span> <span id="coins">1000</span></div>
            <div class="resource-item"><span class="res-icon">üíé</span> <span id="diamonds">50</span></div>
            <div class="resource-item">
                <span class="res-icon">‚ö°</span> <span id="energy">10/10</span>
                <div class="energy-timer" id="energyTimer"></div>
            </div>
            <div class="resource-item"><span class="res-icon">üå∏</span> <span id="flowers">20</span></div>
        </div>

        <div class="level-container">
            <div class="level-badge" id="levelNum">1</div>
            <div class="xp-bar-bg">
                <div class="xp-bar-fill" id="xpBar"></div>
            </div>
            <div class="level-title" id="levelTitle">–ù–æ–≤–∏—á–æ–∫</div>
        </div>

        <div id="content-area">
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('profile')">
                <i class="fas fa-crown"></i>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </div>
            <div class="nav-item" onclick="switchTab('studios')">
                <i class="fas fa-cut"></i>
                <span>–°—Ç—É–¥–∏–∏</span>
            </div>
            <div class="nav-item" onclick="switchTab('podium')">
                <i class="fas fa-trophy"></i>
                <span>–ü–æ–¥–∏—É–º</span>
            </div>
            <div class="nav-item" onclick="switchTab('company')">
                <i class="fas fa-building"></i>
                <span>–ö–æ–º–ø–∞–Ω–∏—è</span>
                <div class="badge-notify" id="companyBadge" style="display:none;">!</div>
            </div>
            <div class="nav-item" onclick="switchTab('travel')">
                <i class="fas fa-plane"></i>
                <span>–¢—Ä–µ–≤–µ–ª</span>
            </div>
            <div class="nav-item" onclick="switchTab('forum')" id="nav-forum">
                <i class="fas fa-comments"></i>
                <span>–§–æ—Ä—É–º</span>
            </div>
        </div>
    </div>

    <script>
        // --- –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ---
        let state = {
            coins: 1000,
            diamonds: 50,
            energy: 10,
            maxEnergy: 10,
            flowers: 20,
            user: "LadyAqua",

            // –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            level: 1,
            xp: 0,
            maxXp: 100,
            title: "–ù–æ–≤–∏—á–æ–∫",
            lastLogin: Date.now(),

            // –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏
            lastEnergyTick: Date.now(),

            company: {
                // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ú–æ–¥–Ω–æ–º –î–æ–º–µ (–∫–æ–º–ø–∞–Ω–∏–∏)
                name: "Vogue Syndicate",
                level: 1,            // –£—Ä–æ–≤–µ–Ω—å –î–æ–º–∞
                reputation: 0,       // –û–±—â–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è (–∫—É–±–∫–∏)

                // –≠–∫–æ–Ω–æ–º–∏–∫–∞
                treasury: 12500,     // –ö–∞—Å—Å–∞ –î–æ–º–∞ (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π)
                bank: 0,             // –ü–∞—Å—Å–∏–≤–Ω–∞—è –ø—Ä–∏–±—ã–ª—å, –¥–æ—Å—Ç—É–ø–Ω–∞—è –∫ —Å–±–æ—Ä—É –∏–≥—Ä–æ–∫–æ–º
                maxBank: 500,        // –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–µ–π—Ñ–∞
                corporatePoints: 0,  // –õ–∏—á–Ω—ã–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ—á–∫–∏ –∏–≥—Ä–æ–∫–∞ (–∑–∞ –≤–∫–ª–∞–¥)

                // –§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –æ–¥–Ω–∞ –∏–∑ —Å—Ç—É–¥–∏–π)
                focus: "marketing",  // marketing | logistics | hr

                // –í—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞—Ñ—Ñ –∫–æ–º–ø–∞–Ω–∏–∏ (–º–∏–Ω–∏-–±–∞—Ñ—Ñ –æ—Ç —Å—Ç–∞—Ä—à–∏—Ö —Ä–æ–ª–µ–π)
                buff: {
                    active: false,
                    endsAt: 0,
                    multiplier: 1.0
                },

                // –†–æ–ª–∏ (–ø–æ–∫–∞ –æ–¥–∏–Ω–æ—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –∏–≥—Ä–æ–∫ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –í–ª–∞–¥–µ–ª–∏—Ü–∞)
                role: "CEO",         // –í –±—É–¥—É—â–µ–º –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

                // –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã –ú–æ–¥–Ω–æ–≥–æ –î–æ–º–∞ (–ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É ‚Äî —Å—Ç—É–¥–∏–∏/–æ—Ç–¥–µ–ª—ã)
                departments: [
                    {
                        id: 'marketing',
                        name: '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥',
                        level: 12,
                        progress: 45,
                        max: 100,
                        icon: 'fa-bullhorn',
                        desc: '–ü—Ä–∏–±—ã–ª—å: 5/–º–∏–Ω. –§–æ–∫—É—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—ã—Ä—É—á–∫—É –æ—Ç –∞–∫—Ü–∏–π.',
                        income: 5
                    },
                    {
                        id: 'logistics',
                        name: '–õ–æ–≥–∏—Å—Ç–∏–∫–∞',
                        level: 5,
                        progress: 20,
                        max: 100,
                        icon: 'fa-truck',
                        desc: '–ü—Ä–∏–±—ã–ª—å: 2/–º–∏–Ω. –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫—É.',
                        income: 2
                    },
                    {
                        id: 'hr',
                        name: 'HR –û—Ç–¥–µ–ª',
                        level: 8,
                        progress: 80,
                        max: 100,
                        icon: 'fa-users',
                        desc: '–ü—Ä–∏–±—ã–ª—å: 3/–º–∏–Ω. –ù–∞–Ω–∏–º–∞–µ—Ç —Ç–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç–æ–≤ –∏ —Å—Ç–∞–∂—ë—Ä–æ–≤.',
                        income: 3
                    }
                ]
            },

            // –°–∏—Å—Ç–µ–º–∞ –∫–æ–º–ø–∞–Ω–∏–π/–≥–∏–ª—å–¥–∏–π (–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–¥ —Ç–µ–∫—É—â–µ–π –∫–æ–º–ø–∞–Ω–∏–µ–π)
            companySystem: {
                hasCompany: true,  // –∏–≥—Ä–æ–∫ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —É–∂–µ –≤ –∫–æ–º–ø–∞–Ω–∏–∏
                myCompanyId: 1
            },

            // –£—á–∞—Å—Ç–Ω–∏—Ü—ã —Ç–µ–∫—É—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ (–ø—Ä–æ—Ç–æ—Ç–∏–ø —Å–ø–∏—Å–∫–∞)
            companyMembers: [
                { name: "LadyAqua", role: "CEO", title: "–í–ª–∞–¥–µ–ª–∏—Ü–∞", online: true,  contribCoins: 5200, contribEnergy: 140, corpPoints: 260, reputationGiven: 35, weeksInCompany: 12 },
                { name: "JuliaStyle", role: "ART", title: "–ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä", online: true,  contribCoins: 3800, contribEnergy: 120, corpPoints: 210, reputationGiven: 27, weeksInCompany: 9 },
                { name: "KatyPop", role: "TOP", title: "–¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç", online: false, contribCoins: 2700, contribEnergy: 90,  corpPoints: 160, reputationGiven: 19, weeksInCompany: 7 },
                { name: "LenaGreen", role: "TOP", title: "–¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç", online: true,  contribCoins: 3100, contribEnergy: 130, corpPoints: 190, reputationGiven: 22, weeksInCompany: 8 },
                { name: "MilaStar", role: "TRAINEE", title: "–°—Ç–∞–∂—ë—Ä", online: false, contribCoins: 600,  contribEnergy: 25,  corpPoints: 40,  reputationGiven: 4,  weeksInCompany: 2 }
            ],

            // –ó–∞—è–≤–∫–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –í–ª–∞–¥–µ–ª–∏—Ü–∞ –∏ –ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä)
            companyApplications: [
                { name: "AnyaChic", level: 9, note: "–û–±–æ–∂–∞—é –ø–æ–¥–∏—É–º –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏", style: "–ü–æ–¥–∏—É–º" },
                { name: "VeraBloom", level: 6, note: "–§–ª–æ—Ä–∏—Å—Ç–∏–∫–∞ –∏ –ø–æ–º–æ—â—å –≤ –∏–≤–µ–Ω—Ç–∞—Ö", style: "–§–ª–æ—Ä–∏—Å—Ç–∏–∫–∞" }
            ],

            // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç –∫–æ–º–ø–∞–Ω–∏–∏ (–ø—Ä–æ—Å—Ç—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
            companyChat: [
                { author: "LadyAqua", text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Vogue Syndicate!", time: "10:05" },
                { author: "JuliaStyle", text: "–°–µ–≥–æ–¥–Ω—è –∫–∞—á–∞–µ–º –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –¥–æ 13 —É—Ä–æ–≤–Ω—è üíº", time: "10:07" }
            ],

            // –õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π –∫–æ–º–ø–∞–Ω–∏–∏
            companyLog: [
                { text: "–ö–æ–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞: Vogue Syndicate", time: "09:00" },
                { text: "JuliaStyle –ø–æ–≤—ã—à–µ–Ω–∞ –¥–æ –ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞", time: "09:30" },
                { text: "–ó–∞–ø—É—â–µ–Ω –º–∏–Ω–∏-–±–∞—Ñ—Ñ –∫–æ–º–ø–∞–Ω–∏–∏ (+30% –∫ –¥–æ—Ö–æ–¥—É –Ω–∞ 10 –º–∏–Ω)", time: "09:45" }
            ],

            // –°–ø–∏—Å–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π (–¥–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è/–ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
            companyDirectory: [
                { id: 1, name: "Vogue Syndicate", level: 5, members: 24, reputation: 320, open: true, minLevel: 5, feeDiamonds: 5, description: "–≠–ª–∏—Ç–Ω—ã–π –¥–æ–º –¥–ª—è –ª—é–±–∏—Ç–µ–ª—å–Ω–∏—Ü –ø–æ–¥–∏—É–º–∞ –∏ –ª—é–∫—Å–∞." },
                { id: 2, name: "Floral Queens", level: 3, members: 18, reputation: 190, open: true, minLevel: 3, feeDiamonds: 0, description: "–§–ª–æ—Ä–∏—Å—Ç–∏–∫–∏ –º–Ω–æ–≥–æ –Ω–µ –±—ã–≤–∞–µ—Ç. –ë—É–∫–µ—Ç—ã, –∫–æ–Ω–∫—É—Ä—Å—ã –∏ —É—é—Ç." },
                { id: 3, name: "Travel Muses", level: 4, members: 30, reputation: 260, open: false, minLevel: 6, feeDiamonds: 10, description: "–ó–∞–∫—Ä—ã—Ç—ã–π –∫–ª—É–± –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏—Ü. –í—Ö–æ–¥ –ø–æ –∑–∞—è–≤–∫–∞–º." }
            ],

            // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
            quests: [
                { id: 1, text: "–°–æ–±—Ä–∞—Ç—å 1 –±—É–∫–µ—Ç", target: 1, current: 0, reward: 50, done: false },
                { id: 2, text: "–í–ª–æ–∂–∏—Ç—å –≤ –∫–æ–º–ø–∞–Ω–∏—é", target: 1, current: 0, reward: 100, done: false }
            ]
        };

        // –°–∏—Å—Ç–µ–º–∞ —Ç–∏—Ç—É–ª–æ–≤
        const TITLES = ["–ù–æ–≤–∏—á–æ–∫", "–ú–æ–¥–Ω–∏—Ü–∞", "–ò–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä", "–ó–≤–µ–∑–¥–∞", "–ò–∫–æ–Ω–∞ –°—Ç–∏–ª—è", "–õ–µ–≥–µ–Ω–¥–∞", "–ë–æ–≥–∏–Ω—è", "–ö–æ—Ä–æ–ª–µ–≤–∞"];

        // --- –î–ê–ù–ù–´–ï –§–û–†–£–ú–ê (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        let forumDb = [
            {
                id: 1, title: "–ü—Ä–∞–≤–∏–ª–∞ –ö–æ–º–ø–∞–Ω–∏–∏", author: "Admin",
                messages: [{ author: "Admin", text: "–°–æ–±–ª—é–¥–∞–π—Ç–µ –¥—Ä–µ—Å—Å-–∫–æ–¥!" }, { author: "JuliaStyle", text: "–ü—Ä–∏–Ω—è—Ç–æ!" }]
            },
            {
                id: 2, title: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ '–î–µ–Ω—å –û–≥—É—Ä—Ü–∞'", author: "LenaGreen",
                messages: [{ author: "LenaGreen", text: "–ó–µ–ª–µ–Ω—ã–µ —Å—É–º–∫–∏ –¥–∞—é—Ç –±–æ–Ω—É—Å?" }, { author: "LadyAqua", text: "–î–∞, –±–µ—Ä–∏ –∏–∑—É–º—Ä—É–¥–Ω—É—é!" }]
            },
            {
                id: 3, title: "–§–ª—É–¥–∏–ª–∫–∞", author: "KatyPop",
                messages: [{ author: "KatyPop", text: "–ö—Ç–æ –Ω–∞ –ú–∞–ª—å–¥–∏–≤—ã?" }]
            }
        ];
        let currentForumView = { mode: "list", topicId: null };

        // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        // –†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ "–ö–æ–º–ø–∞–Ω–∏—è": —Å–≤–æ—è / –∫–∞—Ç–∞–ª–æ–≥ / –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏—Ü—ã
        let companyViewMode = 'own'; // 'own' | 'browse' | 'member'
        let selectedCompanyMember = null;
        let companyChatInput = "";

        // --- –®–ê–ë–õ–û–ù–´ ---
        const views = {
            profile: ``, // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π
            studios: `
                         <div class="page-header"><i class="fas fa-leaf"></i> –°—Ç—É–¥–∏—è –§–ª–æ—Ä–∏—Å—Ç–∏–∫–∏</div>
                         <p style="text-align: center; color: rgba(255,255,255,0.8); font-size: 12px;">–°–æ–±–∏—Ä–∞–π –±—É–∫–µ—Ç—ã –∏ –ø–æ–ª—É—á–∞–π –æ–ø—ã—Ç!</p>

                         <div class="card">
                            <div style="display:flex; justify-content:space-between;">
                                <div><div style="font-weight:bold;">üíê –ë—É–∫–µ—Ç "–ú–æ—Ä—Å–∫–æ–π –±—Ä–∏–∑"</div><div style="font-size:12px; margin-top:5px;">–¢—Ä–µ–±—É–µ—Ç: 5 üå∏</div></div>
                                <div style="text-align:right; font-weight:bold; color: var(--accent-yellow);">+200 üí∞</div>
                            </div>
                            <button class="btn-action btn-blue" onclick="craftBouquet(5, 200, 20)">–°–æ–±—Ä–∞—Ç—å (+20 XP)</button>
                         </div>

                         <div class="card">
                            <div style="display:flex; justify-content:space-between;">
                                <div><div style="font-weight:bold;">üåπ –ë—É–∫–µ—Ç "–õ–∞–≥—É–Ω–∞"</div><div style="font-size:12px; margin-top:5px;">–¢—Ä–µ–±—É–µ—Ç: 10 üå∏</div></div>
                                <div style="text-align:right; font-weight:bold; color: var(--accent-yellow);">+450 üí∞</div>
                            </div>
                            <button class="btn-action btn-blue" onclick="craftBouquet(10, 450, 40)">–°–æ–±—Ä–∞—Ç—å (+40 XP)</button>
                         </div>
                    `,
            podium: `
                        <div class="page-header"><i class="fas fa-trophy"></i> –ü–æ–¥–∏—É–º</div>
                        <div class="card" style="text-align:center;">
                            <h3 style="margin:0 0 10px 0;">–¢–µ–º–∞: "–í–µ—á–µ—Ä–∏–Ω–∫–∞ –Ω–∞ –Ø—Ö—Ç–µ"</h3>
                            <div style="font-size:12px; opacity:0.8;">–î–æ –∫–æ–Ω—Ü–∞: 02:29:15</div>
                            <button class="btn-action btn-pink" onclick="participatePodium()">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å (‚ö° 2)</button>
                        </div>
                        <div class="card">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div style="width:40px; height:40px; background:#ddd; border-radius:50%;"></div>
                                <div style="flex:1;"><div>–£—á–∞—Å—Ç–Ω–∏—Ü–∞: <strong>JuliaStyle</strong></div></div>
                                <button class="btn-teal" style="width: auto; padding: 5px 15px; margin:0;" onclick="showToast('–í–∞—à –≥–æ–ª–æ—Å –ø—Ä–∏–Ω—è—Ç! +5 XP'); addXP(5);">–ì–æ–ª–æ—Å</button>
                            </div>
                        </div>
                    `,
            company: ``, // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
            travel: `
                        <div class="page-header"><i class="fas fa-plane"></i> –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</div>
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div><strong>üå¥ –ú–∞–ª—å–¥–∏–≤—ã</strong><div style="font-size:11px; opacity:0.8;">–û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π –ø–ª—è–∂!</div></div>
                                <button class="btn-action btn-blue" style="width: auto; padding: 8px 20px; font-size: 12px;" onclick="travel(500)">–õ–µ—Ç–µ—Ç—å (500üí∞)</button>
                            </div>
                        </div>
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div><strong>üá´üá∑ –ù–∏—Ü—Ü–∞</strong><div style="font-size:11px; opacity:0.8;">–ù–µ–¥–µ–ª—è –º–æ–¥—ã</div></div>
                                <button class="btn-action btn-blue" style="width: auto; padding: 8px 20px; font-size: 12px;" onclick="travel(1200)">–õ–µ—Ç–µ—Ç—å (1200üí∞)</button>
                            </div>
                        </div>
                    `,
            forum: ''
        };

        // --- –ì–ï–ù–ï–†–ê–¢–û–†–´ HTML ---

        function getProfileHTML() {
            return `
                    <div class="page-header"><i class="fas fa-crown"></i> ${state.title}</div>
                    <div class="avatar-placeholder"></div>
                    <div style="text-align: center; color: white; margin-bottom: 20px;">
                        <div style="font-size: 20px; font-weight: bold;">${state.user}</div>
                        <div style="font-size: 12px; opacity: 0.8;">"–°–∏—è–π —è—Ä—á–µ –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤!"</div>
                    </div>

                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:10px; color:var(--accent-yellow);">üìã –ó–ê–î–ê–ß–ò –ù–ê –î–ï–ù–¨</div>
                        ${state.quests.map(q => `
                            <div class="quest-item">
                                <div style="display:flex; align-items:center;">
                                    <i class="fas fa-check-circle quest-check ${q.done ? 'done' : ''}"></i>
                                    <div style="font-size:13px; ${q.done ? 'text-decoration:line-through; opacity:0.6;' : ''}">${q.text}</div>
                                </div>
                                <div style="font-size:11px; color:var(--accent-pink);">+${q.reward}üí∞</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span>üëó –ì–∞—Ä–¥–µ—Ä–æ–±</span>
                            <button class="btn-blue" style="width: auto; padding: 5px 15px; margin:0;">–û—Ç–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                `;
        }

        function getCompanyHTML() {
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏
            if (!state.companySystem.hasCompany) {
                return `
                    <div class="page-header"><i class="fas fa-building"></i> –ö–æ–º–ø–∞–Ω–∏–∏</div>

                    <div class="card">
                        <div style="font-size:13px; margin-bottom:8px;">–¢—ã –µ—â—ë –Ω–µ –≤ –∫–æ–º–ø–∞–Ω–∏–∏. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Å—å –∫ –ú–æ–¥–Ω–æ–º—É –î–æ–º—É –∏–ª–∏ —Å–æ–∑–¥–∞–π —Å–≤–æ–π –±—Ä–µ–Ω–¥ –∏ —Ä–∞–∑–≤–∏–≤–∞–π –µ–≥–æ –≤–º–µ—Å—Ç–µ —Å –ø–æ–¥—Ä—É–≥–∞–º–∏.</div>
                        <button class="btn-action btn-gold" onclick="createCompany()">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</button>
                    </div>

                    <p style="color: white; font-size: 13px; padding-left: 10px; opacity: 0.9;">–ü–û–ü–£–õ–Ø–†–ù–´–ï –ö–û–ú–ü–ê–ù–ò–ò</p>

                    ${state.companyDirectory.map(c => `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <div style="font-weight:bold; font-size:15px;">${c.name}</div>
                                    <div style="font-size:11px; opacity:0.8;">–£—Ä. ${c.level} ‚Ä¢ ${c.members} —É—á–∞—Å—Ç–Ω–∏—Ü ‚Ä¢ –†–µ–ø—É—Ç–∞—Ü–∏—è ${c.reputation}</div>
                                    <div style="font-size:11px; opacity:0.8; margin-top:4px;">${c.description}</div>
                                </div>
                                <div style="text-align:right;">
                                    <div style="font-size:10px; margin-bottom:6px; color:${c.open ? '#a5d6a7' : '#ffcc80'};">
                                        ${c.open ? '–û—Ç–∫—Ä—ã—Ç—ã–π –Ω–∞–±–æ—Ä' : '–¢–æ–ª—å–∫–æ –ø–æ –∑–∞—è–≤–∫–µ'}
                                    </div>
                                    <button class="btn-action btn-blue" style="width:auto; padding:8px 14px; font-size:11px;" onclick="joinCompany(${c.id})">
                                        –í—Å—Ç—É–ø–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}`;
            }

            // –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏
            if (companyViewMode === 'browse') {
                return `
                    <div class="page-header"><i class="fas fa-building"></i> –ö–∞—Ç–∞–ª–æ–≥ –∫–æ–º–ø–∞–Ω–∏–π</div>

                    <div class="card">
                        <div style="font-size:13px; margin-bottom:8px;">–¢—ã —Å–æ—Å—Ç–æ–∏—à—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏ <strong>${state.company.name}</strong>, –Ω–æ –º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ –¥–æ–º–∞ –∏ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Å–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É.</div>
                        <button class="btn-action btn-teal" onclick="showMyCompany()">–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è</button>
                    </div>

                    ${state.companyDirectory.map(c => `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <div style="font-weight:bold; font-size:15px;">${c.name}</div>
                                    <div style="font-size:11px; opacity:0.8;">–£—Ä. ${c.level} ‚Ä¢ ${c.members} —É—á–∞—Å—Ç–Ω–∏—Ü ‚Ä¢ –†–µ–ø—É—Ç–∞—Ü–∏—è ${c.reputation}</div>
                                    <div style="font-size:11px; opacity:0.8; margin-top:4px;">${c.description}</div>
                                </div>
                                <div style="text-align:right;">
                                    <div style="font-size:10px; margin-bottom:6px; color:${c.open ? '#a5d6a7' : '#ffcc80'};">
                                        ${c.open ? '–û—Ç–∫—Ä—ã—Ç—ã–π –Ω–∞–±–æ—Ä' : '–¢–æ–ª—å–∫–æ –ø–æ –∑–∞—è–≤–∫–µ'}
                                    </div>
                                    <button class="btn-action btn-blue" style="width:auto; padding:8px 14px; font-size:11px;" onclick="changeCompany(${c.id})">
                                        –ü–µ—Ä–µ–π—Ç–∏
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}`;
            }

            // –ü—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏—Ü—ã –∫–æ–º–ø–∞–Ω–∏–∏
            if (companyViewMode === 'member' && selectedCompanyMember) {
                const m = selectedCompanyMember;
                const initials = m.name.slice(0, 2).toUpperCase();
                const roleBadgeClass =
                    m.role === 'CEO' ? 'role-ceo' :
                    m.role === 'ART' ? 'role-art' :
                    m.role === 'TOP' ? 'role-top' : 'role-trainee';
                const statusClass = m.online ? 'online' : 'offline';
                const statusText = m.online ? '–°–µ–π—á–∞—Å –æ–Ω–ª–∞–π–Ω' : '–ù–µ –≤ —Å–µ—Ç–∏';
                const isMe = m.name === state.user;

                // –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –≤–∫–ª–∞–¥—É –º–æ–Ω–µ—Ç + —ç–Ω–µ—Ä–≥–∏–∏
                const sorted = [...state.companyMembers].sort((a, b) => (b.contribCoins + b.contribEnergy * 5) - (a.contribCoins + a.contribEnergy * 5));
                const rank = sorted.findIndex(x => x.name === m.name) + 1;

                // –û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–∏
                let roleNote = '';
                if (m.role === 'CEO') {
                    roleNote = '–í–ª–∞–¥–µ–ª–∏—Ü–∞ —Ä–µ—à–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –î–æ–º–∞, —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∞–ø–≥—Ä–µ–π–¥—ã –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.';
                } else if (m.role === 'ART') {
                    roleNote = '–ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ–º–æ–≥–∞–µ—Ç —Å –ø—Ä–∏—ë–º–æ–º –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏—Ü –∏ —Å–ª–µ–¥–∏—Ç –∑–∞ —Å—Ç–∏–ª–µ–º –∫–æ–º–ø–∞–Ω–∏–∏.';
                } else if (m.role === 'TOP') {
                    roleNote = '–¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç ‚Äî –æ–¥–Ω–∞ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏—Ü, —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–∏–Ω–æ—Å–∏—Ç –≤ –∫–æ–º–ø–∞–Ω–∏—é –º–æ–Ω–µ—Ç—ã –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é.';
                } else {
                    roleNote = '–°—Ç–∞–∂—ë—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç –∏—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫: —É—á–∏—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∫–∞–º –∏–≥—Ä—ã –∏ –≤–Ω–æ—Å–∏—Ç –ø–µ—Ä–≤—ã–µ –≤–∫–ª–∞–¥—ã –≤ –î–æ–º.';
                }

                // –ö–∞—Ä—Ç–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –í–ª–∞–¥–µ–ª–∏—Ü—ã –∏ —Ç–æ–ª—å–∫–æ –Ω–µ –¥–ª—è —Å–µ–±—è)
                let manageCardHtml = '';
                if (state.company.role === 'CEO' && !isMe) {
                    manageCardHtml =
                        `<div class="card">
                            <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏—Ü–µ–π</div>
                            <p style="font-size:11px; opacity:0.85; margin-bottom:8px;">–ò–∑–º–µ–Ω–∏ –µ—ë —Ä–æ–ª—å –∏–ª–∏ –∏—Å–∫–ª—é—á–∏ –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏. –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤–ª–∏—è—é—Ç –Ω–∞ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –î–æ–º–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∏—Ö –∞–∫–∫—É—Ä–∞—Ç–Ω–æ.</p>
                            <div style="display:flex; flex-direction:column; gap:6px;">
                                <button class="btn-action btn-teal" style="padding:8px 10px; font-size:12px;" onclick="promoteMember('${m.name}')">–ü–æ–≤—ã—Å–∏—Ç—å —Ä–æ–ª—å</button>
                                <button class="btn-action btn-blue" style="padding:8px 10px; font-size:12px;" onclick="demoteMember('${m.name}')">–ü–æ–Ω–∏–∑–∏—Ç—å —Ä–æ–ª—å</button>
                                <button class="btn-action btn-gold" style="padding:8px 10px; font-size:12px;" onclick="transferOwnership('${m.name}')">–°–¥–µ–ª–∞—Ç—å –í–ª–∞–¥–µ–ª–∏—Ü–µ–π</button>
                                <button class="btn-action btn-pink" style="padding:8px 10px; font-size:12px;" onclick="kickMember('${m.name}')">–ò—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏</button>
                            </div>
                        </div>`;
                }

                return `
                    <div class="page-header"><i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏—Ü—ã</div>

                    <div class="card" style="text-align:center;">
                        <div class="member-avatar" style="width:60px;height:60px;font-size:20px;margin:0 auto 10px auto;background:rgba(255,255,255,0.9);">
                            <span style="color:${m.role === 'CEO' ? '#fdd835' : '#00897b'};">${initials}</span>
                        </div>
                        <div style="font-size:18px; font-weight:bold; margin-bottom:4px;">
                            ${m.name} ${isMe ? '<span style="font-size:11px; opacity:0.7;">(—ç—Ç–æ –≤—ã)</span>' : ''}
                        </div>
                        <div style="margin-bottom:6px;">
                            <span class="role-badge ${roleBadgeClass}">
                                ${m.role === 'CEO' ? '–í–ª–∞–¥–µ–ª–∏—Ü–∞ (CEO)' :
                                   m.role === 'ART' ? '–ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä' :
                                   m.role === 'TOP' ? '–¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç' : '–°—Ç–∞–∂—ë—Ä'}
                            </span>
                        </div>
                        <div class="member-status ${statusClass}" style="margin-bottom:10px;">${statusText}</div>
                        <div style="font-size:11px; opacity:0.8;">–í –∫–æ–º–ø–∞–Ω–∏–∏: ${m.weeksInCompany} –Ω–µ–¥.</div>
                        <div style="font-size:11px; opacity:0.8;">–†–µ–π—Ç–∏–Ω–≥ –≤–∫–ª–∞–¥–∞: #${rank} –≤ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                    </div>

                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–í–∫–ª–∞–¥ –≤ –∫–æ–º–ø–∞–Ω–∏—é</div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:6px; font-size:13px;">
                            <span>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –º–æ–Ω–µ—Ç–∞–º–∏</span>
                            <span style="font-weight:bold;">${m.contribCoins.toLocaleString('ru-RU')} üí∞</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:6px; font-size:13px;">
                            <span>–†–∞–±–æ—Ç–∞ —ç–Ω–µ—Ä–≥–∏–µ–π</span>
                            <span style="font-weight:bold;">${m.contribEnergy} ‚ö°</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:6px; font-size:13px;">
                            <span>–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ—á–∫–∏</span>
                            <span style="font-weight:bold; color:var(--accent-pink);">${m.corpPoints} ‚óé</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; font-size:13px;">
                            <span>–î–∞–Ω–æ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –î–æ–º—É</span>
                            <span style="font-weight:bold; color:var(--accent-yellow);">+${m.reputationGiven}</span>
                        </div>
                    </div>

                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–ó–∞–º–µ—Ç–∫–∏ –æ —Ä–æ–ª–∏</div>
                        <div style="font-size:12px; opacity:0.9;">${roleNote}</div>
                    </div>

                    ${manageCardHtml}

                    <div style="display:flex; gap:10px; margin:10px 0 15px 0;">
                        <button class="btn-action btn-blue" style="flex:1; padding:10px 8px; font-size:12px;" onclick="backToCompanyFromMember()">–ù–∞–∑–∞–¥ –∫ –∫–æ–º–ø–∞–Ω–∏–∏</button>
                    </div>
                `;
            }

            const totalIncome = state.company.departments.reduce((acc, d) => acc + d.income, 0);
            const focusNames = {
                marketing: "–§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",
                logistics: "–§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: –õ–æ–≥–∏—Å—Ç–∏–∫–∞",
                hr: "–§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: HR –û—Ç–¥–µ–ª"
            };
            const totalMembers = state.companyMembers.length;
            const onlineMembers = state.companyMembers.filter(m => m.online).length;
            const ceoCount = state.companyMembers.filter(m => m.role === 'CEO').length;
            const artCount = state.companyMembers.filter(m => m.role === 'ART').length;
            const topCount = state.companyMembers.filter(m => m.role === 'TOP').length;
            const traineeCount = state.companyMembers.filter(m => m.role === 'TRAINEE').length;
            const canReviewApplications = state.company.role === 'CEO' || state.company.role === 'ART';

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ (hh:mm)
            function getNowTimeString() {
                const d = new Date();
                const h = String(d.getHours()).padStart(2, '0');
                const m = String(d.getMinutes()).padStart(2, '0');
                return `${h}:${m}`;
            }

            // –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏
            if (companyViewMode === 'browse') {
                return `
                    <div class="page-header"><i class="fas fa-building"></i> –ö–∞—Ç–∞–ª–æ–≥ –∫–æ–º–ø–∞–Ω–∏–π</div>

                    <div class="card">
                        <div style="font-size:13px; margin-bottom:8px;">–¢—ã —Å–æ—Å—Ç–æ–∏—à—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏ <strong>${state.company.name}</strong>, –Ω–æ –º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ –¥–æ–º–∞ –∏ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Å–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É.</div>
                        <button class="btn-action btn-teal" onclick="showMyCompany()">–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è</button>
                    </div>

                    ${state.companyDirectory.map(c => `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <div style="font-weight:bold; font-size:15px;">${c.name}</div>
                                    <div style="font-size:11px; opacity:0.8;">–£—Ä. ${c.level} ‚Ä¢ ${c.members} —É—á–∞—Å—Ç–Ω–∏—Ü ‚Ä¢ –†–µ–ø—É—Ç–∞—Ü–∏—è ${c.reputation}</div>
                                    <div style="font-size:11px; opacity:0.8; margin-top:4px;">${c.description}</div>
                                </div>
                                <div style="text-align:right;">
                                    <div style="font-size:10px; margin-bottom:6px; color:${c.open ? '#a5d6a7' : '#ffcc80'};">
                                        ${c.open ? '–û—Ç–∫—Ä—ã—Ç—ã–π –Ω–∞–±–æ—Ä' : '–¢–æ–ª—å–∫–æ –ø–æ –∑–∞—è–≤–∫–µ'}
                                    </div>
                                    <button class="btn-action btn-blue" style="width:auto; padding:8px 14px; font-size:11px;" onclick="changeCompany(${c.id})">
                                        –ü–µ—Ä–µ–π—Ç–∏
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}`;
            }

            return `
                    <div class="page-header"><i class="fas fa-building"></i> –ú–æ–¥–Ω—ã–π –î–æ–º</div>

                    <!-- –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –î–æ–º–µ -->
                    <div class="card" style="background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.25) 100%);">
                        <div class="company-header">
                            <div>
                                <div style="font-size: 18px; font-weight: bold;">${state.company.name}</div>
                                <div style="font-size: 11px; opacity: 0.8;">–£—Ä. –î–æ–º–∞: ${state.company.level} ‚Ä¢ –†–µ–ø—É—Ç–∞—Ü–∏—è: ${state.company.reputation} ‚≠ê</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top:3px;">${focusNames[state.company.focus] || ''}</div>
                            </div>
                            <div class="company-logo">V</div>
                        </div>

                        <div style="margin-top:8px; display:flex; gap:6px;">
                            <button class="btn-blue" style="flex:1; font-size:11px; padding:6px 8px; border-radius:16px; border:none; cursor:pointer;" onclick="showCompanyDirectory()">–î—Ä—É–≥–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</button>
                            <button class="btn-teal" style="flex:1; font-size:11px; padding:6px 8px; border-radius:16px; border:none; cursor:pointer;" onclick="leaveCompany()">–í—ã–π—Ç–∏</button>
                            <button class="btn-pink" style="flex:1; font-size:11px; padding:6px 8px; border-radius:16px; border:none; cursor:pointer;" onclick="disbandCompany()">–†–∞—Å–ø—É—Å—Ç–∏—Ç—å</button>
                        </div>

                        <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center; gap:10px;">
                            <div>
                                <div style="font-size:10px; opacity:0.7;">–ö–∞—Å—Å–∞ –î–æ–º–∞</div>
                                <div style="font-size:14px; font-weight:bold; color:var(--accent-yellow);">${state.company.treasury} üí∞</div>
                            </div>
                            <div>
                                <div style="font-size:10px; opacity:0.7;">–ú–æ–∏ –∫–æ—Ä–ø. –æ—á–∫–∏</div>
                                <div style="font-size:14px; font-weight:bold; color:var(--accent-pink);">${state.company.corporatePoints} ‚óé</div>
                            </div>
                        </div>
                    </div>

                    <!-- –°–µ–π—Ñ –∏ –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ -->
                    <div class="card ${state.company.bank >= state.company.maxBank * 0.8 ? 'highlight' : ''}" style="background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.2) 100%);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-size:10px; opacity:0.7;">–í —Å–µ–π—Ñ–µ (–ø—Ä–∏–±—ã–ª—å –î–æ–º–∞):</div>
                                <div style="font-size:20px; font-weight:bold; color:var(--accent-yellow);">${Math.floor(state.company.bank)} / ${state.company.maxBank} üí∞</div>
                                <div style="font-size:11px; opacity:0.8; margin-top:2px;">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥: ${totalIncome * 10} üí∞/–º–∏–Ω</div>
                            </div>
                            <button class="btn-gold" style="padding:8px 20px; border-radius:20px; border:none; font-weight:bold; cursor:pointer;" onclick="collectBank()">–ó–∞–±—Ä–∞—Ç—å</button>
                        </div>
                    </div>

                    <!-- –ë–ª–æ–∫ –ø—Ä–æ —Ä–æ–ª–∏ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é (—É–ø—Ä–æ—â—ë–Ω–Ω–æ, –¥–ª—è —Å–æ–ª–æ) -->
                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–†–æ–ª—å –≤ –î–æ–º–µ</div>
                        <div style="font-size:13px; margin-bottom:4px;">–í—ã: <strong>–í–ª–∞–¥–µ–ª–∏—Ü–∞ (CEO)</strong></div>
                        <div style="font-size:11px; opacity:0.8;">–í—ã —Ä–µ—à–∞–µ—Ç–µ, –∫—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã: –ø—Ä–æ–∫–∞—á–∏–≤–∞—Ç—å –æ—Ç–¥–µ–ª—ã –∏–ª–∏ –∫–æ–ø–∏—Ç—å –≤ –∫–∞—Å—Å–µ. –í–∫–ª–∞–¥ –≤ –æ—Ç–¥–µ–ª—ã –ø—Ä–∏–Ω–æ—Å–∏—Ç <span style="color:var(--accent-pink);">–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ—á–∫–∏</span>, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å –≤ –±—É–¥—É—â–µ–º –º–∞–≥–∞–∑–∏–Ω–µ –î–æ–º–∞.</div>
                    </div>

                    <!-- –û–±–∑–æ—Ä —Å–æ—Å—Ç–∞–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏ -->
                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–°–æ—Å—Ç–∞–≤ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <div style="font-size:12px; margin-bottom:4px;">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏—Ü: <strong>${totalMembers}</strong> (–æ–Ω–ª–∞–π–Ω: <span style="color:#a5d6a7;">${onlineMembers}</span>)</div>
                        <div style="font-size:11px; opacity:0.85;">
                            CEO: <strong>${ceoCount}</strong> ‚Ä¢
                            –ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤: <strong>${artCount}</strong> ‚Ä¢
                            –¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç–æ–≤: <strong>${topCount}</strong> ‚Ä¢
                            –°—Ç–∞–∂—ë—Ä–æ–≤: <strong>${traineeCount}</strong>
                        </div>
                    </div>

                    <!-- –£—á–∞—Å—Ç–Ω–∏—Ü—ã –∫–æ–º–ø–∞–Ω–∏–∏ -->
                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–£—á–∞—Å—Ç–Ω–∏—Ü—ã –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <ul class="member-list">
                            ${state.companyMembers.map(m => {
                                const initials = m.name.slice(0, 2).toUpperCase();
                                const roleClass =
                                    m.role === 'CEO' ? 'role-ceo' :
                                    m.role === 'ART' ? 'role-art' :
                                    m.role === 'TOP' ? 'role-top' : 'role-trainee';
                                const statusClass = m.online ? 'online' : 'offline';
                                const statusText = m.online ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ–ª–∞–π–Ω';
                                const isMe = m.name === state.user;
                                return `
                                    <li class="member-item" onclick="viewMemberProfile('${m.name}')">
                                        <div class="member-main">
                                            <div class="member-avatar">${initials}</div>
                                            <div>
                                                <div style="font-size:12px;">
                                                    ${m.name}
                                                    ${isMe ? '<span style="font-size:10px; opacity:0.7;">(–≤—ã)</span>' : ''}
                                                </div>
                                                <div class="member-status ${statusClass}">${m.title}</div>
                                            </div>
                                        </div>
                                        <div style="text-align:right;">
                                            <div class="role-badge ${roleClass}">
                                                ${m.role === 'CEO' ? 'CEO' :
                                                   m.role === 'ART' ? '–ê–†–¢' :
                                                   m.role === 'TOP' ? '–¢–û–ü' : '–°–¢–ê–ñ–Å–†'}
                                            </div>
                                            <div class="member-status ${statusClass}" style="margin-top:3px;">${statusText}</div>
                                        </div>
                                    </li>
                                `;
                            }).join('')}
                        </ul>
                    </div>

                    <!-- –ó–∞—è–≤–∫–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é (–≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –í–ª–∞–¥–µ–ª–∏—Ü–∞ –∏ –ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä) -->
                    ${canReviewApplications && state.companyApplications && state.companyApplications.length > 0 ? `
                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–ó–∞—è–≤–∫–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é</div>
                        ${state.companyApplications.map(app => `
                            <div style="padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.1);">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <div>
                                        <div style="font-size:13px; font-weight:bold;">${app.name}</div>
                                        <div style="font-size:11px; opacity:0.8;">–£—Ä–æ–≤–µ–Ω—å ${app.level} ‚Ä¢ –§–æ–∫—É—Å: ${app.style}</div>
                                        <div style="font-size:11px; opacity:0.8; margin-top:3px;">"${app.note}"</div>
                                    </div>
                                    <div style="display:flex; flex-direction:column; gap:4px;">
                                        <button class="btn-teal" style="padding:4px 10px; font-size:11px; border-radius:12px; border:none; cursor:pointer;" onclick="acceptApplication('${app.name}')">–ü—Ä–∏–Ω—è—Ç—å</button>
                                        <button class="btn-pink" style="padding:4px 10px; font-size:11px; border-radius:12px; border:none; cursor:pointer;" onclick="rejectApplication('${app.name}')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}

                    <!-- –ú–∏–Ω–∏-–±–∞—Ñ—Ñ –∫–æ–º–ø–∞–Ω–∏–∏ (–¥–ª—è –¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç–æ–≤ –∏ –≤—ã—à–µ) -->
                    ${(state.company.role === 'TOP' || state.company.role === 'ART' || state.company.role === 'CEO') ? `
                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–ú–∏–Ω–∏-–±–∞—Ñ—Ñ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        ${state.company.buff && state.company.buff.active
                            ? (() => {
                                const msLeft = Math.max(0, state.company.buff.endsAt - Date.now());
                                const totalSeconds = Math.floor(msLeft / 1000);
                                const minutes = Math.floor(totalSeconds / 60);
                                const seconds = totalSeconds % 60;
                                return `
                                    <div style="font-size:12px; opacity:0.9; margin-bottom:6px;">
                                        –ê–∫—Ç–∏–≤–µ–Ω –±–æ–Ω—É—Å –∫ –¥–æ—Ö–æ–¥—É <strong>+${Math.round((state.company.buff.multiplier - 1) * 100)}%</strong>.
                                    </div>
                                    <div style="font-size:11px; opacity:0.8; margin-bottom:8px;">
                                        –û—Å—Ç–∞–ª–æ—Å—å: ${minutes} –º–∏–Ω ${seconds} —Å
                                    </div>
                                    <button class="btn-action btn-gold" style="font-size:12px;" disabled>–ë–∞—Ñ—Ñ –∑–∞–ø—É—â–µ–Ω</button>
                                `;
                            })()
                            : `
                                <div style="font-size:12px; opacity:0.9; margin-bottom:6px;">
                                    –ó–∞–ø—É—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å –∫ –¥–æ—Ö–æ–¥—É –∫–æ–º–ø–∞–Ω–∏–∏. –°—Ç–æ–∏–º–æ—Å—Ç—å: <strong>2 ‚ö°</strong> –∏ <strong>15 ‚óé</strong>.
                                </div>
                                <div style="font-size:11px; opacity:0.8; margin-bottom:8px;">
                                    –ë–∞—Ñ—Ñ –¥–∞—ë—Ç <strong>+30% –∫ –ø–∞—Å—Å–∏–≤–Ω–æ–º—É –¥–æ—Ö–æ–¥—É</strong> –Ω–∞ 10 –º–∏–Ω—É—Ç.
                                </div>
                                <button class="btn-action btn-gold" style="font-size:12px;" onclick="launchMiniBuff()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∞—Ñ—Ñ</button>
                            `}
                    </div>
                    ` : ''}

                    <!-- –õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π –∫–æ–º–ø–∞–Ω–∏–∏ -->
                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–õ–µ–Ω—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <div style="max-height:120px; overflow-y:auto; font-size:11px;">
                            ${(state.companyLog && state.companyLog.length
                                ? state.companyLog.slice().reverse().map(item => `
                                    <div style="padding:4px 0; border-bottom:1px solid rgba(255,255,255,0.08);">
                                        <span style="opacity:0.6;">[${item.time}]</span>
                                        <span style="margin-left:4px;">${item.text}</span>
                                    </div>
                                `).join('')
                                : '<div style="opacity:0.7;">–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π. –°–æ–≤–µ—Ä—à–∞–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è, —á—Ç–æ–±—ã –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ª–µ–Ω—Ç—É.</div>'
                            )}
                        </div>
                    </div>

                    <!-- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç –∫–æ–º–ø–∞–Ω–∏–∏ -->
                    <div class="card">
                        <div style="font-size:12px; font-weight:bold; margin-bottom:6px; color:var(--accent-yellow);">–ß–∞—Ç –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <div style="max-height:120px; overflow-y:auto; font-size:12px; margin-bottom:8px;">
                            ${(state.companyChat && state.companyChat.length
                                ? state.companyChat.slice(-20).map(msg => `
                                    <div style="margin-bottom:4px;">
                                        <span style="opacity:0.6; font-size:10px;">[${msg.time}]</span>
                                        <span style="font-weight:bold; margin-left:4px;">${msg.author}:</span>
                                        <span style="margin-left:4px;">${msg.text}</span>
                                    </div>
                                `).join('')
                                : '<div style="opacity:0.7;">–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏.</div>'
                            )}
                        </div>
                        <div style="display:flex; gap:4px;">
                            <input id="companyChatInput" type="text" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1; padding:6px 8px; border-radius:8px; border:none; font-size:11px;">
                            <button class="btn-action btn-blue" style="width:70px; padding:6px 8px; font-size:11px;" onclick="sendCompanyChat()">Send</button>
                        </div>
                    </div>

                    <p style="color: white; font-size: 13px; padding-left: 10px; opacity: 0.9;">–î–ï–ü–ê–†–¢–ê–ú–ï–ù–¢–´ (–û–±—â–∏–π –≤–∫–ª–∞–¥ –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ—Ö–æ–¥ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é)</p>

                    ${state.company.departments.map(dept => `
                    <div class="card">
                        <div style="display:flex; align-items:center; margin-bottom: 5px;">
                            <i class="fas ${dept.icon} dept-icon" style="font-size:18px; margin-right:10px; width:25px; text-align:center;"></i>
                            <div style="flex:1;">
                                <div style="display:flex; justify-content:space-between;">
                                    <strong>${dept.name}</strong>
                                    <span style="font-size:12px;">–£—Ä. ${dept.level}</span>
                                </div>
                                <div style="font-size:10px; opacity:0.7;">${dept.desc}</div>
                                <div style="font-size:10px; opacity:0.8; margin-top:3px;">–î–æ—Ö–æ–¥ –æ—Ç–¥–µ–ª–∞: ${dept.income} üí∞/–º–∏–Ω</div>
                            </div>
                        </div>

                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${dept.progress}%"></div>
                        </div>

                        <div style="display:flex; gap: 10px;">
                            <button class="btn-blue" style="width:50%; font-size: 11px; padding: 8px; border-radius: 8px; border:none; cursor:pointer;" onclick="investCompany('${dept.id}', 100, 'coins')">–í–ª–æ–∂–∏—Ç—å 100 üí∞</button>
                            <button class="btn-teal" style="width:50%; font-size: 11px; padding: 8px; border-radius: 8px; border:none; cursor:pointer;" onclick="investCompany('${dept.id}', 1, 'energy')">–†–∞–±–æ—Ç–∞—Ç—å (1 ‚ö°)</button>
                        </div>
                    </div>
                    `).join('')}`;
        }

        // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ---

        // –¢–∞–π–º–µ—Ä –∏–≥—Ä—ã (1 —Ç–∏–∫ –≤ —Å–µ–∫—É–Ω–¥—É)
        setInterval(() => {
            // 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
            if (state.energy < state.maxEnergy) {
                let now = Date.now();
                let diff = now - state.lastEnergyTick;
                let secondsLeft = 60 - Math.floor(diff / 1000); // 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ 1 —ç–Ω–µ—Ä–≥–∏—é

                if (diff >= 60000) { // –ü—Ä–æ—à–ª–∞ –º–∏–Ω—É—Ç–∞
                    state.energy++;
                    state.lastEnergyTick = now;
                    updateUI();
                } else {
                    document.getElementById('energyTimer').innerText = secondsLeft + "—Å";
                }
            } else {
                document.getElementById('energyTimer').innerText = "";
                state.lastEnergyTick = Date.now();
            }

            // 2. –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –∫–æ–º–ø–∞–Ω–∏–∏ (–ú–æ–¥–Ω–æ–≥–æ –î–æ–º–∞)
            if (state.company.bank < state.company.maxBank) {
                // –°—É–º–º–∞ –¥–æ—Ö–æ–¥–∞ –≤—Å–µ—Ö –æ—Ç–¥–µ–ª–æ–≤
                let totalIncome = state.company.departments.reduce((acc, d) => acc + d.income, 0);
                // –ù–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å –∫ –¥–æ—Ö–æ–¥—É –∑–∞ —É—Ä–æ–≤–µ–Ω—å –î–æ–º–∞
                totalIncome += state.company.level;

                // –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞—Ñ—Ñ–∞ –∫–æ–º–ø–∞–Ω–∏–∏
                let multiplier = 1;
                if (state.company.buff && state.company.buff.active) {
                    const now = Date.now();
                    if (now >= state.company.buff.endsAt) {
                        state.company.buff.active = false;
                        state.company.buff.multiplier = 1.0;
                    } else {
                        multiplier = state.company.buff.multiplier;
                    }
                }

                // –î–µ–ª–∏–º –Ω–∞ 6, —Ç–∞–∫ –∫–∞–∫ —Ç–∏–∫ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É, –∞ –¥–æ—Ö–æ–¥ —É–∫–∞–∑–∞–Ω "—É—Å–ª–æ–≤–Ω—ã–π"
                state.company.bank += (totalIncome * multiplier / 6);
                if (state.company.bank > state.company.maxBank) state.company.bank = state.company.maxBank;

                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ —Ç–∞–±–µ –µ—Å–ª–∏ –±–∞–Ω–∫ –ø–æ—á—Ç–∏ –ø–æ–ª–æ–Ω
                const badge = document.getElementById('companyBadge');
                if (state.company.bank >= state.company.maxBank * 0.8) {
                    badge.style.display = "flex";
                } else {
                    badge.style.display = "none";
                }
            }
        }, 1000);

        function updateUI() {
            document.getElementById('coins').innerText = Math.floor(state.coins);
            document.getElementById('diamonds').innerText = state.diamonds;
            document.getElementById('energy').innerText = state.energy + "/" + state.maxEnergy;
            document.getElementById('flowers').innerText = state.flowers;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ XP
            let xpPercent = (state.xp / state.maxXp) * 100;
            document.getElementById('xpBar').style.width = xpPercent + "%";
            document.getElementById('levelNum').innerText = state.level;
            document.getElementById('levelTitle').innerText = state.title;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[onclick="switchTab('${tabName}')"]`).classList.add('active');

            const container = document.getElementById('content-area');
            if (tabName === 'profile') {
                container.innerHTML = getProfileHTML();
            } else if (tabName === 'company') {
                container.innerHTML = getCompanyHTML();
            } else if (tabName === 'forum') {
                renderForum();
            } else {
                container.innerHTML = views[tabName];
            }
        }

        // --- –ò–ì–†–û–í–´–ï –î–ï–ô–°–¢–í–ò–Ø ---

        function addXP(amount) {
            state.xp += amount;
            if (state.xp >= state.maxXp) {
                state.xp -= state.maxXp;
                state.level++;
                state.maxXp = Math.floor(state.maxXp * 1.5);
                state.diamonds += 5; // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å
                state.energy = state.maxEnergy; // –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏—Ç—É–ª–∞
                if (state.level <= TITLES.length) {
                    state.title = TITLES[state.level - 1];
                }

                showModal("–ü–æ–≤—ã—à–µ–Ω–∏–µ –£—Ä–æ–≤–Ω—è!", `–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è ${state.level}!<br>–¢–∏—Ç—É–ª: ${state.title}<br>–ù–∞–≥—Ä–∞–¥–∞: +5 üíé –∏ –ü–æ–ª–Ω–∞—è –≠–Ω–µ—Ä–≥–∏—è!`);
            }
            updateUI();
        }

        function updateQuest(id, amount) {
            let q = state.quests.find(x => x.id === id);
            if (q && !q.done) {
                q.current += amount;
                if (q.current >= q.target) {
                    q.done = true;
                    state.coins += q.reward;
                    showToast(`–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! +${q.reward} –º–æ–Ω–µ—Ç`);
                }
            }
        }

        // –°—Ç—É–¥–∏—è
        window.craftBouquet = function (costFlowers, rewardCoins, xpReward) {
            if (state.flowers >= costFlowers) {
                state.flowers -= costFlowers;
                state.coins += rewardCoins;
                showToast(`–ë—É–∫–µ—Ç —Å–æ–±—Ä–∞–Ω! +${rewardCoins} –º–æ–Ω–µ—Ç`);
                addXP(xpReward);
                updateQuest(1, 1); // –ö–≤–µ—Å—Ç –Ω–∞ –±—É–∫–µ—Ç—ã
            } else {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ü–≤–µ—Ç–æ–≤!");
            }
        }

        // –ü–æ–¥–∏—É–º
        window.participatePodium = function () {
            if (state.energy >= 2) {
                state.energy -= 2;
                showToast("–í—ã –ø–æ–¥–∞–ª–∏ –∑–∞—è–≤–∫—É! –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ 2—á.");
                addXP(50); // –ú–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –∑–∞ –∫–æ–Ω–∫—É—Ä—Å
            } else {
                showToast("–ù—É–∂–Ω–æ 2 —ç–Ω–µ—Ä–≥–∏–∏!");
            }
            updateUI();
        }

        // –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
        window.travel = function (cost) {
            if (state.coins >= cost) {
                state.coins -= cost;
                state.energy = Math.min(state.energy + 5, state.maxEnergy); // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 5 —ç–Ω–µ—Ä–≥–∏–∏
                showToast("–û—Ç–ª–∏—á–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ! –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.");
                addXP(100);
                updateUI();
            } else {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
            }
        }

        // –ö–æ–º–ø–∞–Ω–∏—è: –°–±–æ—Ä –¥–µ–Ω–µ–≥ –∏–∑ —Å–µ–π—Ñ–∞
        window.collectBank = function () {
            if (state.company.bank < 1) return;
            let amount = Math.floor(state.company.bank);
            state.coins += amount;
            state.company.bank = 0;

            // –ù–µ–±–æ–ª—å—à–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –î–æ–º–æ–º
            state.company.reputation += Math.floor(amount / 200);
            if (state.company.reputation >= 100) {
                state.company.reputation -= 100;
                state.company.level++;
                showToast(`–ú–æ–¥–Ω—ã–π –î–æ–º –ø–æ–≤—ã—Å–∏–ª —É—Ä–æ–≤–µ–Ω—å! –¢–µ–ø–µ—Ä—å —É—Ä. ${state.company.level}`);
            } else {
                showToast(`–°–æ–±—Ä–∞–Ω–æ ${amount} –º–æ–Ω–µ—Ç –ø—Ä–∏–±—ã–ª–∏!`);
            }
            updateUI();
            switchTab('company'); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞
        }

        // –ö–æ–º–ø–∞–Ω–∏—è: –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–ª–µ–Ω—Å—Ç–≤–æ–º
        window.showCompanyDirectory = function () {
            companyViewMode = 'browse';
            switchTab('company');
        }

        window.showMyCompany = function () {
            if (!state.companySystem.hasCompany) {
                showToast("–í—ã –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –∫–æ–º–ø–∞–Ω–∏–∏");
                return;
            }
            companyViewMode = 'own';
            switchTab('company');
        }

        window.createCompany = function () {
            if (state.companySystem.hasCompany) {
                showToast("–í—ã —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –∫–æ–º–ø–∞–Ω–∏–∏");
                return;
            }
            // –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∫–æ–º–ø–∞–Ω–∏–∏
            const requiredLevel = 5;
            const requiredCoins = 2000;
            const requiredDiamonds = 10;

            if (state.level < requiredLevel) {
                showToast(`–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –Ω—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å ${requiredLevel}+`);
                return;
            }
            if (state.coins < requiredCoins || state.diamonds < requiredDiamonds) {
                showToast(`–ù—É–∂–Ω–æ ${requiredCoins} –º–æ–Ω–µ—Ç –∏ ${requiredDiamonds} üíé –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏`);
                return;
            }

            state.coins -= requiredCoins;
            state.diamonds -= requiredDiamonds;
            state.company = {
                name: "–ú–æ–π –ú–æ–¥–Ω—ã–π –î–æ–º",
                level: 1,
                reputation: 0,
                treasury: 0,
                bank: 0,
                maxBank: 500,
                corporatePoints: 0,
                focus: "marketing",
                role: "CEO",
                departments: JSON.parse(JSON.stringify([
                    { id: 'marketing', name: '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥', level: 1, progress: 0, max: 100, icon: 'fa-bullhorn', desc: '–ü—Ä–∏–±—ã–ª—å: 1/–º–∏–Ω. –§–æ–∫—É—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—ã—Ä—É—á–∫—É –æ—Ç –∞–∫—Ü–∏–π.', income: 1 },
                    { id: 'logistics', name: '–õ–æ–≥–∏—Å—Ç–∏–∫–∞', level: 1, progress: 0, max: 100, icon: 'fa-truck', desc: '–ü—Ä–∏–±—ã–ª—å: 1/–º–∏–Ω. –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫—É.', income: 1 },
                    { id: 'hr', name: 'HR –û—Ç–¥–µ–ª', level: 1, progress: 0, max: 100, icon: 'fa-users', desc: '–ü—Ä–∏–±—ã–ª—å: 1/–º–∏–Ω. –ù–∞–Ω–∏–º–∞–µ—Ç —Ç–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç–æ–≤ –∏ —Å—Ç–∞–∂—ë—Ä–æ–≤.', income: 1 }
                ]))
            };
            state.companySystem.hasCompany = true;
            state.companySystem.myCompanyId = 999;
            companyViewMode = 'own';
            showToast("–ö–æ–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞!");
            if (!state.companyLog) state.companyLog = [];
            const d = new Date();
            const h = String(d.getHours()).padStart(2, '0');
            const m = String(d.getMinutes()).padStart(2, '0');
            state.companyLog.push({ text: `–ö–æ–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏–≥—Ä–æ–∫–æ–º ${state.user}`, time: `${h}:${m}` });
            switchTab('company');
        }

        window.leaveCompany = function () {
            if (!state.companySystem.hasCompany) return;
            showToast("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏");
            state.companySystem.hasCompany = false;
            state.companySystem.myCompanyId = null;
            companyViewMode = 'own';
            switchTab('company');
        }

        window.disbandCompany = function () {
            if (!state.companySystem.hasCompany) return;
            if (state.company.role !== 'CEO') {
                showToast("–†–∞—Å–ø—É—Å—Ç–∏—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –í–ª–∞–¥–µ–ª–∏—Ü–∞");
                return;
            }
            showToast("–ö–æ–º–ø–∞–Ω–∏—è —Ä–∞—Å–ø—É—â–µ–Ω–∞");
            state.companySystem.hasCompany = false;
            state.companySystem.myCompanyId = null;
            companyViewMode = 'own';
            switchTab('company');
        }

        window.joinCompany = function (id) {
            const c = state.companyDirectory.find(x => x.id === id);
            if (!c) return;

            // –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—é
            const minLevel = c.minLevel || 1;
            const feeDiamonds = c.feeDiamonds || 0;

            if (state.level < minLevel) {
                showToast(`–î–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ ${c.name} –Ω—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å ${minLevel}+`);
                return;
            }
            if (feeDiamonds > 0 && state.diamonds < feeDiamonds) {
                showToast(`–î–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ ${feeDiamonds} üíé`);
                return;
            }

            if (!c.open) {
                // –ó–∞–∫—Ä—ã—Ç–∞—è –∫–æ–º–ø–∞–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –∑–∞—è–≤–∫–∞
                if (!state.companyApplications.find(a => a.name === state.user)) {
                    state.companyApplications.push({
                        name: state.user,
                        level: state.level,
                        note: "–•–æ—á—É –≤—Å—Ç—É–ø–∏—Ç—å –≤ –≤–∞—à—É –∫–æ–º–ø–∞–Ω–∏—é",
                        style: "–°–º–µ—à–∞–Ω–Ω—ã–π"
                    });
                }
                showToast("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –û–∂–∏–¥–∞–π—Ç–µ —Ä–µ—à–µ–Ω–∏—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞.");
                return;
            }

            // –û—Ç–∫—Ä—ã—Ç–∞—è –∫–æ–º–ø–∞–Ω–∏—è ‚Äî –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Å—Ä–∞–∑—É
            if (feeDiamonds > 0) {
                state.diamonds -= feeDiamonds;
            }
            state.company.name = c.name;
            state.company.level = c.level;
            state.company.reputation = c.reputation;
            state.company.role = "Member";
            state.companySystem.hasCompany = true;
            state.companySystem.myCompanyId = id;
            companyViewMode = 'own';
            showToast(`–í—ã –≤—Å—Ç—É–ø–∏–ª–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é ${c.name}`);
            switchTab('company');
        }

        window.changeCompany = function (id) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–∞, –∫–æ–≥–¥–∞ —É–∂–µ –≤ –∫–æ–º–ø–∞–Ω–∏–∏
            window.joinCompany(id);
        }

        // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç –∫–æ–º–ø–∞–Ω–∏–∏
        window.sendCompanyChat = function () {
            const input = document.getElementById('companyChatInput');
            if (!input) return;
            const text = input.value.trim();
            if (!text) {
                showToast("–°–æ–æ–±—â–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ");
                return;
            }
            if (!state.companyChat) state.companyChat = [];

            const d = new Date();
            const h = String(d.getHours()).padStart(2, '0');
            const m = String(d.getMinutes()).padStart(2, '0');
            const time = `${h}:${m}`;

            state.companyChat.push({
                author: state.user,
                text,
                time
            });
            if (state.companyChat.length > 100) {
                state.companyChat.shift();
            }

            input.value = "";
            switchTab('company');
        }

        // –ü—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏—Ü—ã –∫–æ–º–ø–∞–Ω–∏–∏
        window.viewMemberProfile = function (name) {
            const m = state.companyMembers.find(x => x.name === name);
            if (!m) {
                showToast("–£—á–∞—Å—Ç–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                return;
            }
            selectedCompanyMember = m;
            companyViewMode = 'member';
            switchTab('company');
        }

        window.backToCompanyFromMember = function () {
            companyViewMode = 'own';
            selectedCompanyMember = null;
            switchTab('company');
        }

        // –ó–∞–ø—É—Å–∫ –º–∏–Ω–∏-–±–∞—Ñ—Ñ–∞ –∫–æ–º–ø–∞–Ω–∏–∏ (–¥–ª—è –¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç–æ–≤ –∏ –≤—ã—à–µ)
        window.launchMiniBuff = function () {
            const role = state.company.role;
            if (!(role === 'TOP' || role === 'ART' || role === 'CEO')) {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–∞—Ñ—Ñ–∞");
                return;
            }
            if (state.company.buff && state.company.buff.active) {
                showToast("–ë–∞—Ñ—Ñ —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω");
                return;
            }
            if (state.energy < 2) {
                showToast("–ù—É–∂–Ω–æ 2 —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–∞—Ñ—Ñ–∞");
                return;
            }
            if (state.company.corporatePoints < 15) {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ—á–∫–æ–≤ (–Ω—É–∂–Ω–æ 15)");
                return;
            }

            state.energy -= 2;
            state.company.corporatePoints -= 15;
            state.company.buff.active = true;
            state.company.buff.multiplier = 1.3;
            state.company.buff.endsAt = Date.now() + 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç

            showToast("–ú–∏–Ω–∏-–±–∞—Ñ—Ñ –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞–ø—É—â–µ–Ω –Ω–∞ 10 –º–∏–Ω—É—Ç!");
            updateUI();
            switchTab('company');
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏—Ü–∞–º–∏ (–¥–ª—è –í–ª–∞–¥–µ–ª–∏—Ü—ã)
        const MAX_ART_DIRECTORS = 1;
        const MAX_TOP_STYLISTS = 3;

        function findMember(name) {
            return state.companyMembers.find(m => m.name === name);
        }

        function countRole(role) {
            return state.companyMembers.filter(m => m.role === role).length;
        }

        window.promoteMember = function (name) {
            if (state.company.role !== 'CEO') {
                showToast("–¢–æ–ª—å–∫–æ –í–ª–∞–¥–µ–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ä–æ–ª–∏");
                return;
            }
            const m = findMember(name);
            if (!m) {
                showToast("–£—á–∞—Å—Ç–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                return;
            }
            if (m.role === 'CEO') {
                showToast("–≠—Ç–æ —É–∂–µ –í–ª–∞–¥–µ–ª–∏—Ü–∞");
                return;
            }
            if (m.role === 'TRAINEE') {
                if (countRole('TOP') >= MAX_TOP_STYLISTS) {
                    showToast("–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç–æ–≤");
                    viewMemberProfile(name);
                    return;
                }
                m.role = 'TOP';
                m.title = '–¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç';
            } else if (m.role === 'TOP') {
                if (countRole('ART') >= MAX_ART_DIRECTORS) {
                    showToast("–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤");
                    viewMemberProfile(name);
                    return;
                }
                m.role = 'ART';
                m.title = '–ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä';
            } else if (m.role === 'ART') {
                showToast("–î–∞–ª—å—à–µ ‚Äî —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–æ–ª–∏ –í–ª–∞–¥–µ–ª–∏—Ü—ã");
                viewMemberProfile(name);
                return;
            }
            showToast("–†–æ–ª—å –ø–æ–≤—ã—à–µ–Ω–∞");
            viewMemberProfile(name);
        }

        window.demoteMember = function (name) {
            if (state.company.role !== 'CEO') {
                showToast("–¢–æ–ª—å–∫–æ –í–ª–∞–¥–µ–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ä–æ–ª–∏");
                return;
            }
            const m = findMember(name);
            if (!m) {
                showToast("–£—á–∞—Å—Ç–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                return;
            }
            if (m.role === 'TRAINEE') {
                showToast("–ù–µ–ª—å–∑—è –ø–æ–Ω–∏–∑–∏—Ç—å –Ω–∏–∂–µ –°—Ç–∞–∂—ë—Ä–∞");
                return;
            }
            if (m.role === 'ART') {
                m.role = 'TOP';
                m.title = '–¢–æ–ø-—Å—Ç–∏–ª–∏—Å—Ç';
            } else if (m.role === 'TOP') {
                m.role = 'TRAINEE';
                m.title = '–°—Ç–∞–∂—ë—Ä';
            }
            showToast("–†–æ–ª—å –ø–æ–Ω–∏–∂–µ–Ω–∞");
            viewMemberProfile(name);
        }

        window.kickMember = function (name) {
            if (state.company.role !== 'CEO') {
                showToast("–¢–æ–ª—å–∫–æ –í–ª–∞–¥–µ–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –∏—Å–∫–ª—é—á–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏—Ü");
                return;
            }
            if (name === state.user) {
                showToast("–ù–µ–ª—å–∑—è –∏—Å–∫–ª—é—á–∏—Ç—å —Å–∞–º—É —Å–µ–±—è");
                return;
            }
            const m = findMember(name);
            if (!m) {
                showToast("–£—á–∞—Å—Ç–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                return;
            }
            state.companyMembers = state.companyMembers.filter(x => x.name !== name);
            showToast("–£—á–∞—Å—Ç–Ω–∏—Ü–∞ –∏—Å–∫–ª—é—á–µ–Ω–∞");
            backToCompanyFromMember();
        }

        // –†–∞–±–æ—Ç–∞ —Å –∑–∞—è–≤–∫–∞–º–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é (–¥–ª—è –í–ª–∞–¥–µ–ª–∏—Ü—ã –∏ –ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞)
        function ensureCanReviewApplications() {
            if (!(state.company.role === 'CEO' || state.company.role === 'ART')) {
                showToast("–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞—è–≤–∫–∞–º–∏");
                return false;
            }
            return true;
        }

        window.acceptApplication = function (name) {
            if (!ensureCanReviewApplications()) return;
            const idx = state.companyApplications.findIndex(a => a.name === name);
            if (idx === -1) {
                showToast("–ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                return;
            }
            const app = state.companyApplications[idx];
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —É—á–∞—Å—Ç–Ω–∏—Ü—É –∫–∞–∫ —Å—Ç–∞–∂—ë—Ä–∞
            state.companyMembers.push({
                name: app.name,
                role: 'TRAINEE',
                title: '–°—Ç–∞–∂—ë—Ä',
                online: false,
                contribCoins: 0,
                contribEnergy: 0,
                corpPoints: 0,
                reputationGiven: 0,
                weeksInCompany: 0
            });
            state.companyApplications.splice(idx, 1);
            showToast("–£—á–∞—Å—Ç–Ω–∏—Ü–∞ –ø—Ä–∏–Ω—è—Ç–∞ –≤ –∫–æ–º–ø–∞–Ω–∏—é");
            switchTab('company');
        }

        window.rejectApplication = function (name) {
            if (!ensureCanReviewApplications()) return;
            const before = state.companyApplications.length;
            state.companyApplications = state.companyApplications.filter(a => a.name !== name);
            if (state.companyApplications.length === before) {
                showToast("–ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
            } else {
                showToast("–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞");
            }
            switchTab('company');
        }

        // –ü–µ—Ä–µ–¥–∞—á–∞ —Ä–æ–ª–∏ –í–ª–∞–¥–µ–ª–∏—Ü—ã –¥—Ä—É–≥–æ–π —É—á–∞—Å—Ç–Ω–∏—Ü–µ
        window.transferOwnership = function (name) {
            if (state.company.role !== 'CEO') {
                showToast("–¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∞—è –í–ª–∞–¥–µ–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å —Ä–æ–ª—å");
                return;
            }
            if (name === state.user) {
                showToast("–í—ã —É–∂–µ –í–ª–∞–¥–µ–ª–∏—Ü–∞");
                return;
            }
            const newCeo = findMember(name);
            if (!newCeo) {
                showToast("–£—á–∞—Å—Ç–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                return;
            }
            if (newCeo.role === 'CEO') {
                showToast("–û–Ω–∞ —É–∂–µ –í–ª–∞–¥–µ–ª–∏—Ü–∞");
                return;
            }

            const oldCeo = findMember(state.user);
            if (oldCeo) {
                oldCeo.role = 'ART';
                oldCeo.title = '–ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä';
            }

            newCeo.role = 'CEO';
            newCeo.title = '–í–ª–∞–¥–µ–ª–∏—Ü–∞';

            state.company.role = 'ART'; // –≤–∞—à–∞ –Ω–æ–≤–∞—è —Ä–æ–ª—å –≤ —Ä–∞–º–∫–∞—Ö –∫–æ–º–ø–∞–Ω–∏–∏

            showToast("–†–æ–ª—å –í–ª–∞–¥–µ–ª–∏—Ü—ã –ø–µ—Ä–µ–¥–∞–Ω–∞");
            viewMemberProfile(name);
        }

        // –ö–æ–º–ø–∞–Ω–∏—è: –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        window.investCompany = function (deptId, cost, currency) {
            let dept = state.company.departments.find(d => d.id === deptId);

            if (currency === 'coins') {
                if (state.coins >= cost) {
                    state.coins -= cost;
                    // –ß–∞—Å—Ç—å —É—Ö–æ–¥–∏—Ç –≤ –ö–∞—Å—Å—É –î–æ–º–∞ (–Ω–∞–ª–æ–≥/–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ)
                    const toTreasury = Math.floor(cost * 0.5);
                    state.company.treasury += toTreasury;
                    dept.progress += 10;

                    // –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ—á–∫–∏ –∑–∞ –≤–∫–ª–∞–¥
                    state.company.corporatePoints += 5;

                    showToast(`–í–∫–ª–∞–¥ –ø—Ä–∏–Ω—è—Ç! +5 –∫–æ—Ä–ø. –æ—á–∫–æ–≤`);
                    updateQuest(2, 1);
                } else {
                    showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!"); return;
                }
            } else if (currency === 'energy') {
                if (state.energy >= cost) {
                    state.energy -= cost;
                    dept.progress += 15;
                    state.coins += 50; // –ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ —Ä–∞–±–æ—Ç—É
                    addXP(10);
                    // –ù–µ–±–æ–ª—å—à–æ–π –≤–∫–ª–∞–¥ –≤ —Ä–µ–ø—É—Ç–∞—Ü–∏—é –∑–∞ –ª–∏—á–Ω—É—é —Ä–∞–±–æ—Ç—É
                    state.company.reputation += 1;
                    state.company.corporatePoints += 2;
                    showToast("–†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! +50 –º–æ–Ω–µ—Ç, +2 –∫–æ—Ä–ø. –æ—á–∫–∞");
                } else {
                    showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!"); return;
                }
            }

            if (dept.progress >= dept.max) {
                dept.level++;
                dept.progress = 0;
                dept.max = Math.floor(dept.max * 1.2);
                dept.income += 1; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
                // –ü—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –æ—Ç–¥–µ–ª–∞ ‚Äî —Ä–æ—Å—Ç —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∏ XP –∏–≥—Ä–æ–∫–∞
                state.company.reputation += 5;
                showToast(`üéâ –û—Ç–¥–µ–ª ${dept.name} –ø–æ–≤—ã—à–µ–Ω! –î–æ—Ö–æ–¥ –≤—ã—Ä–æ—Å, —Ä–µ–ø—É—Ç–∞—Ü–∏—è –î–æ–º–∞ +5.`);
                addXP(100);
            }

            updateUI();
            switchTab('company');
        }

        // --- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ò –§–û–†–£–ú ---

        function showModal(title, text) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalText').innerHTML = text;
            document.getElementById('modal').style.display = 'flex';
        }
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä—É–º–∞ (–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞–∫ –±—ã–ª–∞, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è render)
        function renderForum() {
            const container = document.getElementById('content-area');
            let html = `<div class="page-header"><i class="fas fa-comments"></i> –§–æ—Ä—É–º</div>`;

            if (currentForumView.mode === "list") {
                html += `
                        <ul class="forum-list">
                            ${forumDb.map(t => `
                              <li class="forum-topic" onclick="openForumThread(${t.id})">
                                <div class="forum-thread-title">${t.title}</div>
                                <div style="display:flex; justify-content:space-between; font-size:11px; opacity:.7;">
                                    <span>–ê–≤—Ç–æ—Ä: ${t.author}</span>
                                    <span><i class="fas fa-comment-dots"></i> ${t.messages.length}</span>
                                </div>
                              </li>
                            `).join('')}
                        </ul>`;
            } else if (currentForumView.mode === 'thread') {
                let topic = forumDb.find(f => f.id === currentForumView.topicId);
                html += `
                            <div class="forum-back" onclick="closeForumThread()" style="margin-bottom:10px; cursor:pointer;"><i class="fa fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                            <div class="card" style="min-height: 400px; display:flex; flex-direction:column;">
                              <div class="forum-thread-title" style="border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">${topic.title}</div>
                              <div class="forum-messages" id="forumMessagesBox">
                                ${topic.messages.map(msg => `
                                  <div class="forum-message${msg.author === state.user ? " from-me" : ""}">
                                     <div style="font-size:10px; opacity:0.7; margin-bottom:2px;">${msg.author}</div>
                                     <div>${msg.text}</div>
                                  </div>
                                `).join('')}
                              </div>
                              <div style="margin-top:auto;">
                                  <div style="display:flex; gap:5px;">
                                    <input class="forum-input" id="forumMsgText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                                    <button class="btn-pink" style="border:none; border-radius:8px; width:40px;" onclick="sendForumMsg(${topic.id})"><i class="fas fa-paper-plane"></i></button>
                                  </div>
                              </div>
                            </div>
                        `;
            }
            container.innerHTML = html;
            if (currentForumView.mode === 'thread') {
                const box = document.getElementById('forumMessagesBox');
                if (box) box.scrollTop = box.scrollHeight;
            }
        }

        function openForumThread(id) { currentForumView.mode = 'thread'; currentForumView.topicId = id; renderForum(); }
        function closeForumThread() { currentForumView.mode = 'list'; currentForumView.topicId = null; renderForum(); }
        function sendForumMsg(id) {
            let input = document.getElementById('forumMsgText');
            if (input.value) {
                let t = forumDb.find(f => f.id === id);
                t.messages.push({ author: state.user, text: input.value });
                input.value = '';
                renderForum();
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.style.opacity = 1;
            setTimeout(() => { toast.style.opacity = 0; }, 2000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        setTimeout(() => {
            showModal("–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫", "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞–∑–∞–¥!<br>–í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ: 200 üí∞ –∏ 5 üíé");
            state.coins += 200;
            state.diamonds += 5;
            updateUI();
        }, 1000);

        updateUI();
        switchTab('profile');

    </script>
</body>
</html>



